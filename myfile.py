 # -- coding: utf-8 --
"""myfile

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15e-V4gddIhN9kVunjOiHNkcsxjzHTuap
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px
from streamlit_option_menu import option_menu

# Configuraci칩n de la p치gina de Streamlit
st.set_page_config(page_title="Deforestaci칩n en 츼reas Naturales Protegidas", page_icon="游꺕", initial_sidebar_state="expanded", layout='wide')

# Cargar datos
archivo = "Dataset_DeforestacionAnp_SERNANP.csv"
data = pd.read_csv(archivo)

# Configuraci칩n del men칰
with st.sidebar:
    menu = option_menu(
        menu_title="Men칰 Principal",
        options=["Inicio", "Deforestaci칩n por a침o", "Causas de Deforestaci칩n", "Comparativo", "Zonificaci칩n", "츼rea Deforestada por ANP", "Conoce m치s"],
        icons=["house", "tree", "pie-chart", "bar-chart", "map", "globe", "info-circle"],
        menu_icon="menu-app",
        default_index=0
    )

# Secci칩n: Inicio
if menu == "Inicio":
    st.title('Huellas de la deforestaci칩n')
    st.header("Rastreando el impacto de la p칠rdida forestal en Per칰 a trav칠s del tiempo")
    st.image("https://raw.githubusercontent.com/mcamilaa/streamlit_app/main/imagenes/defo_1.jpg", caption="Deforestaci칩n en 치reas protegidas", use_column_width=False)
    st.write('La deforestaci칩n en Per칰 es un fen칩meno alarmante que ha capturado la atenci칩n de ambientalistas, cient칤ficos y gobiernos por igual. Este pa칤s, hogar de una de las partes m치s ricas en biodiversidad del planeta, enfrenta una creciente amenaza debido a la tala indiscriminada de bosques, impulsada por actividades como la miner칤a y la expansi칩n urbana. En este caso, analizaremos un registro de monitoreo de la Deforestaci칩n en el 치mbito de las 츼reas Naturales, para dar conocimiento especificos sobre ello y generar un an치lisis.')
    st.write("El Registro de Monitoreo de la Deforestaci칩n en el 치mbito de las 츼reas Naturales Protegidas es una herramienta fundamental gestionada por el Servicio Nacional de 츼reas Naturales Protegidas por el Estado (SERNANP) en Per칰. Este organismo, adscrito al Ministerio del Ambiente, tiene como misi칩n asegurar la conservaci칩n de las 치reas protegidas del pa칤s, as칤 como la diversidad biol칩gica y el mantenimiento de sus servicios ambientales. A trav칠s de sistemas de informaci칩n geogr치fica y t칠cnicas de monitoreo biol칩gico, SERNANP recopila y analiza datos sobre la deforestaci칩n y otros cambios en el uso del suelo dentro de estas 치reas. Este registro no solo permite identificar las tendencias de p칠rdida de cobertura forestal, sino que tambi칠n facilita la implementaci칩n de estrategias de conservaci칩n y gesti칩n sostenible, contribuyendo as칤 a la protecci칩n de los ecosistemas y a la mitigaci칩n de los efectos del cambio clim치tico. La informaci칩n obtenida es crucial para la toma de decisiones informadas y para el foralecimiento de las pol칤ticas ambientales en el pa칤s.")
    st.write("De tal forma, nos enfocaremos en el monitoreo de la deforestaci칩n dentro de las 츼reas Naturales Protegidas. Examinaremos datos generales que ilustran la tasa de deforestaci칩n y las tendencias a lo largo del tiempo, as칤 como las implicancias de estas p칠rdidas en la conservaci칩n de la biodiversidad.")

# Secci칩n: Deforestaci칩n por a침o
if menu == "Deforestaci칩n por a침o":
    st.header("츼rea deforestada por a침o")
    st.info("El grafico a continuaci칩n nos permite analizar la perdida de 치reas forestales en las ANP durante los a침os. De este modo, entenderemos la magnitud del problema que vive el Per칰 y apreciaremos los periodos de mayor cambio.")
    # Crear un filtro para seleccionar el a침o
    years = data['ANIO_REPORTE'].unique()
    selected_year = st.selectbox("Selecciona el a침o para mostrar el gr치fico:", years)

    # Funci칩n para procesar y filtrar datos por a침o
    def procesar_datos_por_anio(data, anio):
        meses = {1: 'Enero', 2: 'Febrero', 3: 'Marzo', 4: 'Abril', 5: 'Mayo', 6: 'Junio',
                 7: 'Julio', 8: 'Agosto', 9: 'Septiembre', 10: 'Octubre', 11: 'Noviembre', 12: 'Diciembre'}
        
        # Filtrar datos por a침o
        datos_anio = data[data['ANIO_REPORTE'] == anio]
        
        # Verifica si hay datos despu칠s del filtrado
        if datos_anio.empty:
            st.warning(f"No hay datos para el a침o seleccionado: {anio}")
            return pd.DataFrame(), pd.DataFrame()

        # Agrupar 치rea deforestada por mes
        area_por_mes = datos_anio.groupby('MES_IMAG')['AREA_DEFO'].sum().reset_index()
        area_por_mes['MES_NOMBRE'] = area_por_mes['MES_IMAG'].map(meses)  # Mapear nombres de los meses
        
        return area_por_mes, datos_anio

    # Procesar datos para el a침o seleccionado
    data_anio, datos_filtrados = procesar_datos_por_anio(data, selected_year)

    # Verificar si hay datos antes de crear el gr치fico
    if not data_anio.empty:
        # Colores para cada a침o
        color_map = {2021: 'orange', 2022: 'green', 2023: 'blue'}
        selected_color = color_map.get(selected_year, 'gray')

        # Crear gr치fico con Plotly
        fig = px.line(data_anio, x='MES_NOMBRE', y='AREA_DEFO', title=f'츼rea deforestada por mes en {selected_year}')
        fig.update_traces(
            mode='lines+markers',
            marker=dict(symbol='circle', size=8, color=selected_color),
            line=dict(color=selected_color, width=2)
        )
        fig.update_layout(
            title=dict(
                text=f'츼rea deforestada por mes en {selected_year}',
                font=dict(size=20, color='darkblue')
            ),
            xaxis=dict(
                title='Mes',
                titlefont=dict(size=16, color='darkblue'),
                tickfont=dict(size=14, color='black'),
                showgrid=True,
                gridcolor='lightgrey'
            ),
            yaxis=dict(
                title='츼rea Deforestada (ha)',
                titlefont=dict(size=16, color='darkblue'),
                tickfont=dict(size=14, color='black'),
                showgrid=True,
                gridcolor='lightgrey'
            ),
            plot_bgcolor='white',
            paper_bgcolor='white',
            hovermode='x unified'
        )

        # Mostrar gr치fico en Streamlit
        st.plotly_chart(fig)

        # Mostrar tabla de datos filtrados
        datos_filtrados.index = datos_filtrados.index + 1
        st.write(datos_filtrados[['MES_IMAG', 'ANIO_REPORTE', 'AREA_DEFO']])
        st.markdown("*La tabla muestra los datos de deforestaci칩n mensuales para el a침o seleccionado.*")
        st.info("Este gr치fico ilustra la cantidad de 치rea deforestada (en hect치reas) por mes en el a침o seleccionado.")
    else:
        st.warning("No hay datos suficientes para generar el gr치fico.")
     

# Secci칩n: Causas de Deforestaci칩n (Gr치fico Interactivo)
if menu == "Causas de Deforestaci칩n":
    st.header("Causas de la Deforestaci칩n")
    st.info("a deforestaci칩n no es un fen칩meno aleatorio; es impulsada por una combinaci칩n de factores humanos y naturales. Los cuales tienden a ser unos m치s comunes que otros. Entre las causas humanas m치s comunes se encuentran la agricultura, transporte, mineria y ocupaci칩n humana. Los cuales veremos a continuaci칩n")
    # Agrupaci칩n de datos por causa
    area_causa = data.groupby('DEFO_CAUSA')['AREA_DEFO'].sum().reset_index()
    area_causa = area_causa.sort_values('AREA_DEFO', ascending=False)  # Ordenar por 치rea


    # Paleta de colores
    custom_colors = [
     "#6BAED6",  # Azul claro
     "#FDD835",  # Amarillo dorado
     "#A1D490",  # Verde suave
     "#FF6F61",  # Rojo coral
     "#9575CD"   # Morado
    ]

    # Crear gr치fico de pastel interactivo con Plotly
    fig = px.pie(
        area_causa,
        values='AREA_DEFO',
        names='DEFO_CAUSA',
        title=' ',
        color_discrete_sequence=custom_colors,
        hole=0.3  # Gr치fico de dona
    )
    
    # Personalizar la visualizaci칩n de etiquetas
    fig.update_traces(
        textinfo='percent+label',
        hoverinfo='label+value+percent',
        textfont_size=14
    )

    # Configuraci칩n del dise침o
    fig.update_layout(
        legend=dict(
            title='Causas',
            font=dict(size=14),
            bordercolor='lightgrey',
            borderwidth=1
        )
    )

    # Mostrar el gr치fico interactivo en Streamlit
    st.plotly_chart(fig)

    # Tabla de datos
    st.write("Datos de causa de deforestaci칩n y 치rea deforestada:")
    st.dataframe(area_causa)
   

# Secci칩n: Comparativo
if menu == "Comparativo":
    st.header("Comparaci칩n entre A침os")
    promedios = pd.DataFrame({
        "A침o": ["2021", "2022", "2023"],
        "Promedio Mensual (ha)": [
            data[data['ANIO_REPORTE'] == 2021]['AREA_DEFO'].mean(),
            data[data['ANIO_REPORTE'] == 2022]['AREA_DEFO'].mean(),
            data[data['ANIO_REPORTE'] == 2023]['AREA_DEFO'].mean()
        ]
    })

    fig, ax = plt.subplots()
    ax.bar(promedios['A침o'], promedios['Promedio Mensual (ha)'], color=['orange', 'green', 'blue'])
    ax.set_title('Promedio mensual de 치rea deforestada (2021-2023)')
    ax.set_xlabel('A침o')
    ax.set_ylabel('츼rea Deforestada (ha)')
    st.pyplot(fig)
    st.write(promedios)

# Secci칩n: Zonificaci칩n
if menu == "Zonificaci칩n":
    st.header("Zonificaci칩n de Deforestaci칩n")
    st.write("El gr치fico presentado a continuaci칩n ilustra la deforestaci칩n clasificada por diferentes tipos de zonificaci칩n en 치reas naturales protegidas (ANP). Este an치lisis nos permite identificar las categor칤as m치s afectadas y evaluar c칩mo las actividades humanas o la falta de planificaci칩n contribuyen a la p칠rdida de cobertura forestal.")
    area_zonificacion = data.groupby("ZONIFI_ANP")['AREA_DEFO'].sum().reset_index()
    area_zonificacion = area_zonificacion.sort_values('AREA_DEFO', ascending=True)
    
    fig, ax = plt.subplots()
    ax.barh(area_zonificacion['ZONIFI_ANP'], area_zonificacion['AREA_DEFO'], color='teal')
    ax.set_title('츼rea deforestada por zonificaci칩n')
    ax.set_xlabel('츼rea Deforestada (ha)')
    st.pyplot(fig)
    st.dataframe(area_zonificacion.rename(columns={
        'ZONIFI_ANP': 'Zonificaci칩n',
        'AREA_DEFO': '츼rea Deforestada (ha)'
    }))
    #inicio
    # Crear columnas para distribuir la informaci칩n de forma ordenada
    col1, col2, col3, col4 = st.columns(4)

# Columna 1
    with col1:
        st.markdown("**1. Zona de Aprovechamiento Directo**")
        st.write("츼reas productivas con alta deforestaci칩n por agricultura y ganader칤a.")

# Columna 2
    with col2:
       st.markdown("**2. Zona de Uso Especial**")
       st.write("츼reas protegidas, pero con deforestaci칩n ilegal.")

# Columna 3
    with col3:
        st.markdown("**3. Zona Silvestre**")
        st.write("Territorios de conservaci칩n, afectados por miner칤a y tala ilegal.")

# Columna 4
    with col4:
        st.markdown("**4. No Zonificado**")
        st.write("츼reas sin regulaci칩n, vulnerables a la deforestaci칩n.")

# Nueva fila de columnas para continuar con la informaci칩n
col5, col6, col7, col8 = st.columns(4)

# Columna 5
    with col5:
        st.markdown("**5. Zona de Recuperaci칩n**")
        st.write("츼reas en regeneraci칩n, a칰n afectadas por actividades humanas.")

# Columna 6
    with col6:
        st.markdown("**6. Zona de Protecci칩n Estricta**")
        st.write("츼reas sin intervenci칩n, pero amenazadas por actividades ilegales.")

# Columna 7
    with col7:
        st.markdown("**7. Zona de Uso Tur칤stico y Recreativo**")
        st.write("츼reas tur칤sticas que sufren da침os por crecimiento desordenado.")

# Columna 8
    with col8:
        st.markdown("**8. Zona Hist칩rico Cultural**")
        st.write("츼reas patrimoniales, amenazadas por expansi칩n agr칤cola y urbanizaci칩n ilegal.")
#final
  

# Secci칩n: 츼rea Deforestada por Categor칤a de ANP
if menu == "츼rea Deforestada por ANP":
    st.header("츼rea Deforestada por Categor칤a de ANP (2021-2023)")
    st.write("Las ANP si bien son protegidas por el estado, a칰n existe un sistema poco eficiente para lograr la cobertura total de protecci칩n de las regiones. Debido a que se siguen encontrando expuestas a peligros, en los gr치ficos a continuaci칩n veremos las 치reas deforestadas separadas por categorias de ANP de las diversas partes del Per칰.")
    # Filtrar datos para el periodo 2021-2023
    filtered_data = data[(data["ANIO_REPORTE"] >= 2021) & (data["ANIO_REPORTE"] <= 2023)].copy()

    # Limpieza de la columna "CATEGORIA" (quitar espacios y uniformar formato)
    filtered_data["CATEGORIA"] = filtered_data["CATEGORIA"].str.strip().str.title()

    # Verificar si hay datos despu칠s del filtrado
    if filtered_data.empty:
        st.warning("No se encontraron datos para el per칤odo 2021-2023.")
    else:
        # Agrupar datos por categor칤a y ANP, sumando el 치rea deforestada
        sum_area_deforestation = filtered_data.groupby(["CATEGORIA", "ANP"])["AREA_DEFO"].sum().reset_index()

        # Obtener las categor칤as 칰nicas
        categorias = sum_area_deforestation["CATEGORIA"].unique()

        # Combo box para seleccionar la categor칤a
        categoria_seleccionada = st.selectbox("Selecciona una categor칤a", categorias)

        # Filtrar datos por la categor칤a seleccionada
        categoria_data = sum_area_deforestation[sum_area_deforestation["CATEGORIA"] == categoria_seleccionada]

        # Verificar si hay datos para la categor칤a seleccionada
        if categoria_data.empty:
            st.warning(f"No hay datos para la categor칤a: {categoria_seleccionada}")
        else:
            # Crear gr치fico de dispersi칩n
            fig = px.scatter(
                categoria_data,
                x="ANP",
                y="AREA_DEFO",
                size="AREA_DEFO",
                color="ANP",
                hover_name="ANP",
                title=f"츼rea Deforestada (ha) en {categoria_seleccionada} (2021-2023)",
                labels={"ANP": "츼rea Natural Protegida", "AREA_DEFO": "츼rea Deforestada (ha)"},
                size_max=60,
                color_discrete_sequence=px.colors.qualitative.Set3
            )

            # Mostrar gr치fico en Streamlit
            st.plotly_chart(fig)

        # Mostrar informaci칩n adicional
        st.markdown(f"*Mostrando datos para la categor칤a: {categoria_seleccionada}.*")


# Secci칩n: Conoce m치s
if menu == "Conoce m치s":
    st.header("쮺칩mo ayudo a frenar la deforestaci칩n?")
    st.write("춰Conoce a SOSelva!")

    tab1, tab2, tab3 = st.tabs(["SOSelva", "Impacto Ambiental", "C칩mo puedes ayudar"])

    # Pesta침a 1: SOSelva
    with tab1:
        st.subheader("쯈u칠 es SOSelva?")
        st.write(
            "SOSelva es una iniciativa impulsada por el SERNANP y aliados estrat칠gicos para "
            "proteger las 치reas naturales protegidas de Per칰, combatir la deforestaci칩n y promover "
            "el desarrollo sostenible."
        )
     
        st.markdown(
        """
        <div style="display: flex; justify-content: center; align-items: center;">
            <img src="https://raw.githubusercontent.com/mcamilaa/streamlit_app/main/imagenes/soselva.jpeg" 
                 alt="SOSelva" style="width: 80%; max-width: 500px; height: auto; border-radius: 10px;">
        </div>
        """,
        unsafe_allow_html=True
    )

        st.markdown("### Acciones Principales de SOSelva:")
        st.write("""
        - Monitoreo de 치reas naturales protegidas.
        - Promoci칩n del turismo sostenible.
        - Desarrollo de actividades econ칩micas sostenibles para comunidades locales.
        - Combate de delitos ambientales como el tr치fico de fauna silvestre.
        """)
        st.markdown("### Aliados Estrat칠gicos:")
        st.write("Profonanpe, SPDA, APECO, LATAM Airlines y otros.")
        
        st.info("Conoce m치s en el sitio oficial de [SERNANP](https://www.sernanp.gob.pe).")

    # Pesta침a 2: Impacto Ambiental
    with tab2:
        st.subheader("Impacto Ambiental de la Deforestaci칩n")
        st.write(
            "La deforestaci칩n tiene consecuencias graves en la biodiversidad, el cambio clim치tico "
            "y la sostenibilidad de las comunidades locales. Per칰, al ser un pa칤s megadiverso, "
            "enfrenta desaf칤os significativos debido a la p칠rdida de cobertura forestal."
        )
        st.markdown("### Consecuencias principales:")
        st.write("""
        - P칠rdida de h치bitats para especies end칠micas.
        - Incremento de emisiones de gases de efecto invernadero.
        - Erosi칩n del suelo y p칠rdida de servicios ecosist칠micos.
        """)
        st.image("https://raw.githubusercontent.com/mcamilaa/streamlit_app/refs/heads/main/imagenes/impacto.jpg", 
                 caption="Impacto de la deforestaci칩n en ecosistemas vulnerables", use_column_width=True)

    # Pesta침a 3: C칩mo puedes ayudar
    with tab3:
        st.subheader("쮺칩mo puedes ayudar?")
        st.write(
            "La protecci칩n de nuestros bosques es una tarea colectiva. Aqu칤 hay algunas maneras en las que puedes contribuir:"
        )
        st.markdown("### Opciones para contribuir:")
        st.write("""
        - 游꺔 Participa como voluntario en programas de reforestaci칩n.
        - 游눯 Apoya iniciativas como SOSelva mediante donaciones o difusi칩n.
        - 游늴 Reduce tu consumo de productos asociados con la deforestaci칩n (como madera ilegal).
        - 游닉 Promueve el ecoturismo y las pr치cticas sostenibles.
        """)
        st.success("**Recuerda que** 춰Cada acci칩n cuenta para proteger nuestras 치reas naturales맗rotegidas 游땕!")


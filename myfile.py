# -- coding: utf-8 --
"""myfile

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/15e-V4gddIhN9kVunjOiHNkcsxjzHTuap
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import plotly.express as px
from streamlit_option_menu import option_menu

# Configuraci칩n de la p치gina de Streamlit
st.set_page_config(page_title="Deforestaci칩n en 츼reas Naturales Protegidas", page_icon="游꺕", initial_sidebar_state="expanded", layout='wide')

# Cargar datos
archivo = "Dataset_DeforestacionAnp_SERNANP.csv"
data = pd.read_csv(archivo)

# Configuraci칩n del men칰
with st.sidebar:
    menu = option_menu(
        menu_title="Men칰 Principal",
        options=["Inicio", "Gr치ficos", "Comparativo", "Zonificaci칩n", "츼rea Deforestada por ANP", "Data"],
        icons=["house", "bar-chart", "line-chart", "map", "globe", "table"],
        menu_icon="menu-app",
        default_index=0
    )

# Secci칩n: Inicio
if menu == "Inicio":
    st.title('Huellas de la deforestaci칩n')
    st.header("Rastreando el impacto de la p칠rdida forestal en Per칰 a trav칠s del tiempo")
    st.write("La deforestaci칩n en Per칰 es un fen칩meno alarmante...")
    st.write("En este caso, analizaremos un registro de monitoreo...")

# Secci칩n: Gr치ficos
if menu == "Gr치ficos":
    st.header("Gr치ficos de Deforestaci칩n")
    seleccion_anio = st.selectbox("Selecciona el a침o para mostrar el gr치fico", [2021, 2022, 2023])
    
    # Funci칩n para procesar y filtrar datos
    def procesar_datos_por_anio(data, anio):
        meses = {1: 'Enero', 2: 'Febrero', 3: 'Marzo', 4: 'Abril', 5: 'Mayo', 6: 'Junio',
                 7: 'Julio', 8: 'Agosto', 9: 'Septiembre', 10: 'Octubre', 11: 'Noviembre', 12: 'Diciembre'}
        datos_anio = data[data['ANIO_REPORTE'] == anio]
        area_por_mes = datos_anio.groupby('MES_IMAG')['AREA_DEFO'].sum().reset_index()
        area_por_mes['MES_NOMBRE'] = area_por_mes['MES_IMAG'].map(meses)
        return area_por_mes, datos_anio
    
    # Mostrar gr치ficos seg칰n selecci칩n de a침o
    def graficos_y_tabla(data_anio, datos_filtrados, anio, color):
        st.write(f"Gr치fico del 치rea deforestada por mes en {anio}:")
        fig, ax = plt.subplots()
        ax.plot(data_anio['MES_NOMBRE'], data_anio['AREA_DEFO'], marker='o', color=color)
        ax.set_title(f'츼rea deforestada por mes en {anio}')
        ax.set_xlabel('Mes')
        ax.set_ylabel('츼rea Deforestada (ha)')
        ax.grid(True)
        plt.xticks(rotation=45)
        st.pyplot(fig)
        st.write(f"Datos filtrados para el a침o {anio}:")
        st.dataframe(datos_filtrados[['MES_IMAG', 'ANIO_REPORTE', 'AREA_DEFO']])
    
    data_anio, datos_filtrados = procesar_datos_por_anio(data, seleccion_anio)
    color = {'2021': 'orange', '2022': 'green', '2023': 'blue'}[str(seleccion_anio)]
    graficos_y_tabla(data_anio, datos_filtrados, seleccion_anio, color)

# Secci칩n: Comparativo
if menu == "Comparativo":
    st.header("Comparaci칩n entre A침os")
    promedios = pd.DataFrame({
        "A침o": ["2021", "2022", "2023"],
        "Promedio Mensual (ha)": [
            data[data['ANIO_REPORTE'] == 2021]['AREA_DEFO'].mean(),
            data[data['ANIO_REPORTE'] == 2022]['AREA_DEFO'].mean(),
            data[data['ANIO_REPORTE'] == 2023]['AREA_DEFO'].mean()
        ]
    })

    fig, ax = plt.subplots()
    ax.bar(promedios['A침o'], promedios['Promedio Mensual (ha)'], color=['orange', 'green', 'blue'])
    ax.set_title('Promedio mensual de 치rea deforestada (2021-2023)')
    ax.set_xlabel('A침o')
    ax.set_ylabel('츼rea Deforestada (ha)')
    st.pyplot(fig)
    st.write(promedios)

# Secci칩n: Zonificaci칩n
if menu == "Zonificaci칩n":
    st.header("Zonificaci칩n de Deforestaci칩n")
    area_zonificacion = data.groupby("ZONIFI_ANP")['AREA_DEFO'].sum().reset_index()
    area_zonificacion = area_zonificacion.sort_values('AREA_DEFO', ascending=True)
    
    fig, ax = plt.subplots()
    ax.barh(area_zonificacion['ZONIFI_ANP'], area_zonificacion['AREA_DEFO'], color='teal')
    ax.set_title('츼rea deforestada por zonificaci칩n')
    ax.set_xlabel('츼rea Deforestada (ha)')
    st.pyplot(fig)
    st.dataframe(area_zonificacion.rename(columns={
        'ZONIFI_ANP': 'Zonificaci칩n',
        'AREA_DEFO': '츼rea Deforestada (ha)'
    }))

# Secci칩n: 츼rea Deforestada por Categor칤a de ANP
if menu == "츼rea Deforestada por Categor칤a de ANP":
    st.header("츼rea Deforestada por Categor칤a de ANP (2021-2023)")
    
    # Filtrar datos para el periodo 2021-2023
    filtered_data = data[(data["ANIO_REPORTE"] >= 2021) & (data["ANIO_REPORTE"] <= 2023)].copy()

    # Limpieza de la columna "CATEGORIA" (quitar espacios y uniformar formato)
    filtered_data["CATEGORIA"] = filtered_data["CATEGORIA"].str.strip().str.title()

    # Verificar si hay datos despu칠s del filtrado
    if filtered_data.empty:
        st.warning("No se encontraron datos para el per칤odo 2021-2023.")
    else:
        # Agrupar datos por categor칤a y ANP, sumando el 치rea deforestada
        sum_area_deforestation = filtered_data.groupby(["CATEGORIA", "ANP"])["AREA_DEFO"].sum().reset_index()

        # Obtener las categor칤as 칰nicas
        categorias = sum_area_deforestation["CATEGORIA"].unique()

        # Combo box para seleccionar la categor칤a
        categoria_seleccionada = st.selectbox("Selecciona una categor칤a", categorias)

        # Filtrar datos por la categor칤a seleccionada
        categoria_data = sum_area_deforestation[sum_area_deforestation["CATEGORIA"] == categoria_seleccionada]

        # Verificar si hay datos para la categor칤a seleccionada
        if categoria_data.empty:
            st.warning(f"No hay datos para la categor칤a: {categoria_seleccionada}")
        else:
            # Crear gr치fico de dispersi칩n
            fig = px.scatter(
                categoria_data,
                x="ANP",
                y="AREA_DEFO",
                size="AREA_DEFO",
                color="ANP",
                hover_name="ANP",
                title=f"츼rea Deforestada (ha) en {categoria_seleccionada} (2021-2023)",
                labels={"ANP": "츼rea Natural Protegida", "AREA_DEFO": "츼rea Deforestada (ha)"},
                size_max=60,
                color_discrete_sequence=px.colors.qualitative.Set3
            )

            # Mostrar gr치fico en Streamlit
            st.plotly_chart(fig)

        # Mostrar informaci칩n adicional
        st.markdown(f"*Mostrando datos para la categor칤a: {categoria_seleccionada}.*")


# Secci칩n: Data (al final)
if menu == "Data":
    st.header("Vista completa de los datos")
    st.write("Tabla con todos los datos del registro:")
    st.dataframe(data)
